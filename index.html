</html>
<!DOCTYPE html>
<html lang="zh">
<head>
<meta charset="UTF-8">
<title>å‘˜å·¥ç”µè„‘ç›‘æ§</title>
<style>
body { font-family: Arial; background: #f4f6f8; padding: 20px; }
table { border-collapse: collapse; width: 100%; background: #fff; }
th, td { padding: 10px; border: 1px solid #ddd; text-align: center; }
th { background: #2c3e50; color: white; }
.offline { background: #eee; color: #999; }
button {
  background: #e74c3c;
  color: white;
  border: none;
  padding: 8px 16px;
  margin-bottom: 10px;
  cursor: pointer;
}
</style>
</head>
<body>

<h2>å‘˜å·¥ç”µè„‘ç›‘æ§</h2>
<button onclick="clearData()">ğŸ§¹ æ¸…ç†æ‰€æœ‰æ•°æ®</button>

<table>
<thead>
<tr>
  <th>å‘˜å·¥ID</th>
  <th>CPU</th>
  <th>GPU</th>
  <th>GPUæ¸©åº¦</th>
  <th>å†…å­˜</th>
  <th>ç¡¬ç›˜</th>
  <th>æœ€ååœ¨çº¿</th>
  <th>IP åœ°å€</th>
</tr>
</thead>
<tbody id="table-body"></tbody>
</table>

<script>
async function loadData() {
  const res = await fetch('/data');
  const data = await res.json();
  const tbody = document.getElementById('table-body');
  tbody.innerHTML = '';

  const now = Date.now() / 1000;

  for (const id in data.employees) {
    const item = data.employees[id];
    const emp = item.employee;
    const temps = item.temps || {};
    const offline = now - item.last_seen > 5;

    const tr = document.createElement('tr');
    if (offline) tr.classList.add('offline');

    // å¤„ç† IP åœ°å€
    const ipAddresses = emp.ip_addresses.join('<br>');  // å°† IP åœ°å€æ•°ç»„è½¬æ¢ä¸ºå¸¦æ¢è¡Œç¬¦çš„å­—ç¬¦ä¸²

    // å¤„ç†å†…å­˜å’Œç¡¬ç›˜ä¿¡æ¯
    const memoryInfo = `${emp.memory.size_gb}GB`;
    const diskInfo = `${emp.disk.total_gb}GB`;

    tr.innerHTML = `
      <td>${emp.employee_id}</td>
      <td>${emp.cpu_model || '-'}</td>
      <td>${emp.gpu_model || '-'}</td>
      <td>${temps.gpu_temp ?? '-'}</td>
      <td>${memoryInfo}</td>
      <td>${diskInfo}</td>
      <td>${new Date(item.last_seen * 1000).toLocaleTimeString()}</td>
      <td>${ipAddresses}</td>
    `;
    tbody.appendChild(tr);
  }
}

async function clearData() {
  if (!confirm("ç¡®è®¤æ¸…ç©ºæ‰€æœ‰å‘˜å·¥æ•°æ®ï¼Ÿ")) return;
  await fetch('/api/clear', { method: 'POST' });
  loadData();
}

setInterval(loadData, 1000);
loadData();
</script>

</body>
</html>
